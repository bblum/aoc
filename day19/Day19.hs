import Data.List

data Rule = Leaf String | Seq Rule Rule | Or Rule Rule

match (Leaf s) line = [tail line | isPrefixOf s line]
match (Or r1 r2) line = match r1 line ++ match r2 line
match (Seq r1 r2) line = concat [match r2 rest | rest <- match r1 line]

main = do input <- lines <$> readFile "input.txt"
          print $ length $ filter (any (== "") . match r0) input

x +++ y = Seq x y
x ||| y = Or x y
infixl 8 |||

-- part1
-- r8 = r42
-- r11 = r42 +++ r31

-- part2
r8 = r42 ||| r42 +++ r8
r11 = r42 +++ r31 ||| r42 +++ r11 +++ r31

r20 = Leaf "b"
r30 = Leaf "a"
r77 = r30 +++ r112 ||| r20 +++ r13
r121 = r43 +++ r20 ||| r123 +++ r30
r42 = r57 +++ r30 ||| r101 +++ r20
r50 = r65 +++ r20 ||| r134 +++ r30
r37 = r89 +++ r20 ||| r43 +++ r30
r106 = r16 +++ r30 ||| r54 +++ r20
r17 = r30 +++ r84 ||| r20 +++ r35
r129 = r89 +++ r20 ||| r96 +++ r30
r123 = r30 +++ r30 ||| r20 +++ r95
r115 = r20 +++ r70 ||| r30 +++ r93
r112 = r30 +++ r90 ||| r20 +++ r123
r4 = r20 +++ r55 ||| r30 +++ r5
r72 = r20 +++ r90 ||| r30 +++ r123
r51 = r30 +++ r20 ||| r20 +++ r95
r24 = r131 +++ r30 ||| r7 +++ r20
r94 = r121 +++ r20 ||| r15 +++ r30
r117 = r133 +++ r30 ||| r102 +++ r20
r92 = r28 +++ r20 ||| r43 +++ r30
r70 = r87 +++ r30 ||| r96 +++ r20
r88 = r109 +++ r20 ||| r36 +++ r30
r35 = r20 +++ r36 ||| r30 +++ r61
r96 = r30 +++ r95 ||| r20 +++ r20
r47 = r96 +++ r20 ||| r66 +++ r30
r6 = r20 +++ r55 ||| r30 +++ r123
r130 = r30 +++ r29 ||| r20 +++ r88
r68 = r5 +++ r20 ||| r89 +++ r30
r66 = r95 +++ r95
r75 = r96 +++ r30 ||| r55 +++ r20
r3 = r20 +++ r90 ||| r30 +++ r5
r7 = r20 +++ r53 ||| r30 +++ r123
r86 = r30 +++ r5 ||| r20 +++ r53
r105 = r20 +++ r87
r46 = r134 +++ r20 ||| r87 +++ r30
r102 = r30 +++ r111 ||| r20 +++ r103
r93 = r87 +++ r20 ||| r87 +++ r30
r79 = r116 +++ r20 ||| r71 +++ r30
r33 = r5 +++ r20 ||| r87 +++ r30
r107 = r96 +++ r20 ||| r123 +++ r30
r90 = r20 +++ r30
r110 = r20 +++ r59 ||| r30 +++ r32
r16 = r30 +++ r68 ||| r20 +++ r39
r52 = r4 +++ r20 ||| r38 +++ r30
r71 = r96 +++ r30 ||| r51 +++ r20
r38 = r96 +++ r20 ||| r90 +++ r30
r28 = r20 +++ r30 ||| r30 +++ r30
r27 = r30 +++ r64 ||| r20 +++ r24
r91 = r30 +++ r27 ||| r20 +++ r113
r1 = r20 +++ r90 ||| r30 +++ r134
r54 = r105 +++ r20 ||| r18 +++ r30
r0 = r8 +++ r11
r73 = r65 +++ r20 ||| r55 +++ r30
r132 = r30 +++ r17 ||| r20 +++ r19
r41 = r20 +++ r51 ||| r30 +++ r22
r45 = r22 +++ r30 ||| r53 +++ r20
r14 = r124 +++ r20 ||| r73 +++ r30
r22 = r30 +++ r30
r23 = r87 +++ r30 ||| r55 +++ r20
r10 = r30 +++ r89 ||| r20 +++ r134
r120 = r56 +++ r30 ||| r9 +++ r20
r109 = r95 +++ r134
r127 = r30 +++ r53 ||| r20 +++ r123
r61 = r20 +++ r53 ||| r30 +++ r90
r103 = r127 +++ r30 ||| r23 +++ r20
r116 = r90 +++ r20 ||| r87 +++ r30
r134 = r20 +++ r20 ||| r30 +++ r20
r114 = r20 +++ r63 ||| r30 +++ r41
r64 = r20 +++ r118 ||| r30 +++ r25
r12 = r30 +++ r48 ||| r20 +++ r3
r111 = r20 +++ r23 ||| r30 +++ r72
r60 = r79 +++ r30 ||| r120 +++ r20
r59 = r20 +++ r28 ||| r30 +++ r87
r65 = r20 +++ r30 ||| r20 +++ r20
r44 = r89 +++ r30 ||| r28 +++ r20
r18 = r65 +++ r20 ||| r43 +++ r30
r32 = r95 +++ r123
r43 = r20 +++ r20
r95 = r20 ||| r30
r39 = r89 +++ r20
r87 = r30 +++ r20
r83 = r30 +++ r66 ||| r20 +++ r22
r63 = r20 +++ r123 ||| r30 +++ r55
r48 = r30 +++ r134 ||| r20 +++ r43
r99 = r20 +++ r12 ||| r30 +++ r125
r133 = r20 +++ r100 ||| r30 +++ r110
r80 = r20 +++ r50 ||| r30 +++ r44
r125 = r20 +++ r98 ||| r30 +++ r86
r135 = r128 +++ r30 ||| r130 +++ r20
r131 = r20 +++ r55 ||| r30 +++ r134
r122 = r97 +++ r30 ||| r60 +++ r20
r25 = r30 +++ r43 ||| r20 +++ r51
r55 = r30 +++ r95 ||| r20 +++ r30
r13 = r43 +++ r20 ||| r43 +++ r30
r21 = r20 +++ r76 ||| r30 +++ r80
r98 = r89 +++ r30 ||| r65 +++ r20
r81 = r106 +++ r30 ||| r85 +++ r20
r53 = r30 +++ r30 ||| r20 +++ r20
r78 = r45 +++ r30 ||| r37 +++ r20
r89 = r20 +++ r30 ||| r30 +++ r20
r9 = r96 +++ r30 ||| r43 +++ r20
r31 = r2 +++ r20 ||| r82 +++ r30
r56 = r5 +++ r20 ||| r96 +++ r30
r76 = r1 +++ r20 ||| r23 +++ r30
r62 = r92 +++ r30 ||| r10 +++ r20
r58 = r30 +++ r22 ||| r20 +++ r43
r85 = r77 +++ r20 ||| r67 +++ r30
r26 = r30 +++ r58 ||| r20 +++ r6
r101 = r30 +++ r81 ||| r20 +++ r91
r29 = r83 +++ r30 ||| r47 +++ r20
r126 = r20 +++ r53 ||| r30 +++ r55
r2 = r122 +++ r20 ||| r135 +++ r30
r15 = r5 +++ r30 ||| r51 +++ r20
r34 = r20 +++ r37 ||| r30 +++ r116
r82 = r30 +++ r104 ||| r20 +++ r132
r19 = r40 +++ r20 ||| r62 +++ r30
r108 = r21 +++ r20 ||| r119 +++ r30
r36 = r30 +++ r22 ||| r20 +++ r87
r104 = r69 +++ r30 ||| r99 +++ r20
r100 = r20 +++ r7 ||| r30 +++ r61
r113 = r52 +++ r30 ||| r34 +++ r20
r5 = r30 +++ r30 ||| r30 +++ r20
r40 = r4 +++ r30 ||| r107 +++ r20
r97 = r20 +++ r26 ||| r30 +++ r78
r67 = r30 +++ r131 ||| r20 +++ r126
r118 = r20 +++ r134 ||| r30 +++ r66
r124 = r96 +++ r30 ||| r22 +++ r20
r128 = r30 +++ r114 ||| r20 +++ r14
r119 = r30 +++ r49 ||| r20 +++ r74
r84 = r129 +++ r30 ||| r33 +++ r20
r74 = r30 +++ r6 ||| r20 +++ r46
r49 = r30 +++ r38 ||| r20 +++ r75
r57 = r117 +++ r30 ||| r108 +++ r20
r69 = r20 +++ r94 ||| r30 +++ r115
